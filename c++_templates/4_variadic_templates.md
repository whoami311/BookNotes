# 变参模板

从 C++11 开始，模板参数可以接收数量可变的模板实参。这个特性允许在必须传递任意数量和类型的实参的地方使用模板。一个典型应用是通过类或者框架传递数量和类型都未定的参数，另一个应用是提供泛型代码处理任意数量和类型的参数。

## 变参模板简介

模板参数可以定义为接收无限数量的模板实参，具备这种能力的模板称为变参模板。

### 变参和非变参模板的重载

如果两个函数模板只存在尾部参数包的差别，则首选没有尾部参数包的函数模板。

### `sizeof...` 运算符

C++11 还为变参模板引入 `sizeof` 运算符的一种新形式：`sizeof...`。它会扩展到参数包所含的元素数量。

## 折叠表达式

从 C++17 开始，有一种特性可以用于计算对一个参数包（带有可选的初始值）的所有实参使用二元运算符的结果。

| 折叠表达式 | 计值 |
| - | - |
| (...op pack) | (((pack1 op pack2) op pack3) ... op packN) |
| (pack op ...) | (pack1 op (... (packN-1 op packN))) |
| (init op ... op pack) | (((init op pack1) op pack2) ... op packN) |
| (pack op ... op init) | (pack1 op (... (packN op init))) |

## 变参模板应用

变参模板的一个典型应用是转发可变数量的任意类型的实参。

- 传递实参给由共享指针管理的新的堆对象的构造函数。
- 传递实参给由库启动的线程。
- 传递实参给将新元素压入 `vector` 容器的构造函数。

通常，实参是通过移动语义“完美转发”的。

## 变参类模板和变参表达式

除了上面的示例之外，参数包还可以用在其他地方，例如表达式、类模板、`using` 声明，甚至是推导指引。

## 小结

- 通过使用参数包，可以定义具有任意数量及类型的模板参数的模板。
- 需要使用递归（和）/ 或匹配的非变参函数来处理这些函数。
- 用运算符 `sizeof...` 计算提供给参数包的实参数量。
- 变参模板的一个典型应用是转发任意数量及类型的实参。
- 通过使用折叠表达式，可以将运算符应用于参数包中的所有实参。
