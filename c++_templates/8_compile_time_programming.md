# 编译期编程

C++ 支持编译期编程的多个特性。

- 从 C++98 之前的版本开始，模板就提供了编译期计算的功能，包括使用循环和执行路径选择。
- 通过偏特化，可以在编译期，根据特定的限制或需求，在不同的类模板实现之间进行选择。
- 利用 SFINAE 原则，可以根据不同类型或不同限制，在不同函数模板实现之间进行选择。
- 在 C++11 和 C++14 中，`constexpr` 特性使用“直观的”执行路径选择和从 C++14 开始支持的大多数语句类型（包括 `for` 循环、`switch` 语句等），使得编译期计算得到越来越好的支持。
- C++17 引入了甚至可以在模板之外使用的“编译期 `if`”，通过它可以根据编译期的条件或限制来弃用某些语句。

## 模板元编程

模板是在编译期实例化的（与动态语言截然不同，动态语言是在运行期处理泛型的）。事实证明 C++ 模板的一些特性可以结合实例化过程，进而从 C++ 语言自身产生一种原始递归的“编程语言”。正因如此，模板可以用来“计算一个程序的结果”。

## 使用 `constexpr` 计算

C++11 引入了一个名为 `constexpr` 的新特性，极大简化了各种形式的编译期计算。当然，成功计算一个 `constexpr` 函数仍然需要所有计算步骤在编译期都是可行的和有效的：目前堆内存分配和抛出异常之类不在支持之列。

## 偏特化的执行路径选择

使用偏特化在编译期选择不同的模板实现方案。

因为函数模板不支持偏特化，所以必须使用其他机制，基于某些约束条件来改变函数实现。我们的选择包括以下选项：

- 选择带有静态函数的类；
- 使用 `std::enable_if<>`；
- 使用 SFINAE 特性；
- 使用从 C++17 开始可用的编译期 `if` 特性。